Object Macro Tests
===============================================

/* Encoding Object
   ---------------
   Human says:     Encode something in MD5.
   Expected reply: "something" in MD5 is: 437b930db84b8079c2dd804a71936b5f
   Human says:     Encode something in Base64.
   Expected reply: "something" in Base64 is: c29tZXRoaW5n
*/

> object encode perl
	my ($rs,$method,@args) = @_;
	my $msg = join(" ",@args);

	use Digest::MD5 qw(md5_hex);
	use MIME::Base64 qw(encode_base64);

	if ($method eq "md5") {
		return md5_hex($msg);
	}
	else {
		return encode_base64($msg);
	}
< object

+ encode * in md5
- "<star>" in MD5 is: <call>encode md5 <star></call>

+ encode * in base64
- "<star>" in Base64 is: <call>encode base64 <star></call>

> object testing javascript
	var w = screen.width;
	var h = screen.height;
	var dim = w + "x" + h;
	return dim;
< object

+ test javascript
- Testing javascript... <call>testing</call>.

===============================================
(file
  (statement
    (block
      (object_macro
        (object_start
          (object_name: "encode")
          (object_lang: "perl")
        )
        (object_body: "\n\tmy ($rs,$method,@args) = @_;\n\tmy $msg = join(\" \",@args);\n\n\tuse Digest::MD5 qw(md5_hex);\n\tuse MIME::Base64 qw(encode_base64);\n\n\tif ($method eq \"md5\") {\n\t\treturn md5_hex($msg);\n\t}\n\telse {\n\t\treturn encode_base64($msg);\n\t}\n")
      )
    )
  )
  (statement
    (block
      (trigger_response_block
        (trigger
          (trigger_content: "encode")
          (trigger_content
            (wildcard: "*")
          )
          (trigger_content: "in md5")
        )
        (response
          (response_content
            (tag
              (template_tag
                (template_tag_name: "star")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "star")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
          )
        )
      )
    )
  )
  (statement
    (block
      (trigger_response_block
        (trigger
          (trigger_content: "encode")
          (trigger_content
            (wildcard: "*")
          )
          (trigger_content: "in base64")
        )
        (response
          (response_content
            (tag
              (template_tag
                (template_tag_name: "star")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "star")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
          )
        )
      )
    )
  )
  (statement
    (block
      (object_macro
        (object_start
          (object_name: "testing")
          (object_lang: "javascript")
        )
        (object_body: "\n\tvar w = screen.width;\n\tvar h = screen.height;\n\tvar dim = w + \"x\" + h;\n\treturn dim;\n")
      )
    )
  )
  (statement
    (block
      (trigger_response_block
        (trigger
          (trigger_content: "test javascript")
        )
        (response
          (response_content
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
            (tag
              (template_tag
                (template_tag_name: "call")
              )
            )
          )
        )
      )
    )
  )
)

